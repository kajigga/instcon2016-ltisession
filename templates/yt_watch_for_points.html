{% extends "layout.html" %}

{% block main_content %}
<div class='row'>
  <div class='col-md-12'>
    {% if 'Learner' in session['ext_roles'] %}
    <div class="progress">
      <div id='prog_bar' class="progress-bar" role="progressbar" aria-valuenow="5"
      aria-valuemin="0" aria-valuemax="5" style="width:5%">
        70%
      </div>
    </div>
    <p id='video_description'></p>
    {% else %}
    <form id='video_form' class='form'>
      <div class="form-group">
        <label for="video_id">Video ID</label>
        <input type="textbox" class="form-control" id="video_id" placeholder="Youtube Video ID">
      </div>
      <div class="form-group">
        <label for="video_description">Description</label>
        <textarea rows='3' class="form-control" id="video_description" placeholder="e.g. description"></textarea>
      </div>
      <div class="form-group">
        <label for="minimum_percent">What percentage of the video should be watched for full points?</label>
        <input type="number" max='100' class="form-control" id="minimum_percent" placeholder="" value="100">
      </div>

      <div class="form-group">
        <button type='submit' class='btn btn-default'>Save</button>
      </div>
    </form>
    {% endif %}

  </div>
</div>
<div class='row'>
  <div class='col-md-12'>
    <!-- 1. The <iframe> (and video player) will replace this <div> tag. -->
    <div id="player"></div>
    
    {% if 'Learner' in session['ext_roles'] %}
    <p>You have watched <span id="you_have_watched">...</span>% of 
    this video. Your score is updated in the LMS every couple of seconds.
    </p>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block extra_js %}

<script src="https://www.youtube.com/iframe_api"></script>
<script src="https://cdn.firebase.com/js/client/2.2.1/firebase.js"></script>

<script>
var LTI_ENV = { 
  custom_canvas_user_id: '{{ session.custom_canvas_user_id }}', 
  context_id: '{{session.context_id}}' ,
  resource_link_id: '{{session.resource_link_id}}',
  {% if 'Instructor' in session['ext_roles'] %}
  is_instructor: true
  {% else %}
  is_instructor: false
  {% endif %}
};
</script>
<script src="/static/video_watcher.js"></script>
<script>

{% if 'Instructor' in session['ext_roles'] %}
$(document).ready(function(){
  $('#video_id').change(function(e){
    // change_video_preview
    // get the player, set the video to 
    player.loadVideoById($('#video_id').val());
  });
  $('#video_form').submit(function(e){
    set_video_id(
        $('#video_id').val(), 
        $('#video_description').val(), 
        $('#minimum_percent').val(), 
        function(){ });
    e.preventDefault();
  });
});
{% endif %}
</script>

{% endblock %}
